この問題はロジック実装に関して実用的ではあるものの難易度がやや低く、また過度に煩雑な実装が要求されるため評価は6です。

## 問題概要

あなたは、企業向けの会議室予約管理システムを作成することになった。このシステムは、社員からの会議室予約リクエストを受け付け、会議室の利用状況を管理し、予約の承認・取消・変更を行うことが主な役割である。

社員は、システムを通じて会議室を予約する。予約時には会議室、開始時刻、終了時刻、参加予定人数を指定する。システムは予約の妥当性をチェックし、問題がなければ予約を受理する。

このシステムの特徴として、会議室には収容人数の制限があり、参加予定人数が収容人数を超える予約は受け付けない。また、繰り返し予約機能により、定期的な会議を一度の操作で複数回予約することができる。

システムは営業時間内（平日09:00〜18:00）の予約のみを受け付ける。土日祝日や営業時間外の予約は拒否される。また、現在時刻より過去の時刻での予約はできない。

予約には以下の制限がある：
- 会議室の重複予約は不可
- 最小予約時間は30分
- 最大予約時間は4時間
- 予約は15分単位で行う
- 同一社員による同時間帯の重複予約は不可

上記の説明では、細かい仕様や具体的な入出力方式はまだ書かれていないことに注意せよ。下記の「詳細な仕様」に基づいて、会議室予約システムを適切に管理するプログラムを実装せよ。

## 詳細な仕様

### 日時

与えられる日時は、以下の制約とフォーマットを満たす日付と時刻の組である。

- 日付は YYYY-MM-DD 形式で与えられる。2024年以降の日付のみが保証される。
- 時刻は HH:MM 形式で与えられる。00:00 ≤ HH:MM ≤ 23:59 が保証される。
- 曜日の判定において、土曜日（5）、日曜日（6）は休日として扱う。

### 会議室

会議室は以下の情報を持つ。

- 会議室ID: 3桁の英数字。大文字のアルファベット1文字と2桁の数字で構成される（例：A01）。
- 会議室名: 文字列。日本語を含むことができる。
- 収容人数: 正の整数。この人数以下の予約のみ受け付ける。
- 設備タイプ: NORMAL（通常）、PROJECTOR（プロジェクター付き）、VIDEO（ビデオ会議対応）のいずれか。

### 社員

社員は以下の情報を持つ。

- 社員ID: 6桁の数字。100000から999999までの値を取る。
- 社員名: 文字列。日本語を含むことができる。
- 部署: 文字列。日本語を含むことができる。

### 予約

予約は以下の情報を持つ。

- 予約ID: システムが自動的に割り当てる5桁の数字。10001から開始し、予約が作成されるたびに1ずつ増加する。
- 社員ID: 予約を行った社員のID。
- 会議室ID: 予約された会議室のID。
- 開始時刻: 予約の開始日時。
- 終了時刻: 予約の終了日時。
- 参加予定人数: 正の整数。
- 予約状態: ACTIVE（有効）、CANCELLED（取消済み）のいずれか。

### 営業時間と制限

- 営業日: 月曜日から金曜日（土日は休業）
- 営業時間: 09:00から18:00まで（開始時刻は09:00以降、終了時刻は18:00以前）
- 予約可能時間: 15分単位（例：09:00、09:15、09:30...）
- 最小予約時間: 30分
- 最大予約時間: 4時間（240分）

### 繰り返し予約

繰り返し予約では、指定された期間内で同じ曜日・同じ時間に定期的な予約を作成する。

- 繰り返しタイプ: WEEKLY（毎週）のみサポート
- 繰り返し期間: 開始日から終了日までの期間を指定
- 繰り返し予約では、各回の予約に対して個別の予約IDが割り当てられる

### 予約処理の流れ

システムが予約リクエストを受け取ったら、以下の順序で処理を行う。

1. **社員の存在確認**: 指定された社員IDが登録されているか確認する。
2. **会議室の存在確認**: 指定された会議室IDが登録されているか確認する。
3. **時刻フォーマットの確認**: 開始時刻・終了時刻が正しい形式か確認する。
4. **営業時間の確認**: 予約時間が営業時間内（平日09:00〜18:00）か確認する。
5. **時刻の妥当性確認**: 開始時刻が終了時刻より前で、現在時刻より後か確認する。
6. **時間単位の確認**: 開始時刻・終了時刻が15分単位か確認する。
7. **予約時間の確認**: 予約時間が30分以上240分以下か確認する。
8. **収容人数の確認**: 参加予定人数が会議室の収容人数以下か確認する。
9. **重複予約の確認**: 指定された時間帯に会議室または社員の予約が重複していないか確認する。
10. **予約の作成**: 上記の全てをクリアした場合、予約を作成する。

### エラー処理

以下の場合はエラーメッセージを出力し、予約を作成しない。

- 社員が存在しない場合  
  `ERROR: Employee [社員ID] not found`

- 会議室が存在しない場合  
  `ERROR: Room [会議室ID] not found`

- 営業時間外の場合  
  `ERROR: Booking outside business hours (Mon-Fri 09:00-18:00)`

- 過去の時刻の場合  
  `ERROR: Cannot book in the past`

- 開始時刻が終了時刻以降の場合  
  `ERROR: Start time must be before end time`

- 15分単位でない場合  
  `ERROR: Time must be in 15-minute intervals`

- 予約時間が短すぎる場合  
  `ERROR: Minimum booking duration is 30 minutes`

- 予約時間が長すぎる場合  
  `ERROR: Maximum booking duration is 4 hours`

- 収容人数を超える場合  
  `ERROR: Participants exceed room capacity (capacity: [収容人数])`

- 会議室が重複している場合  
  `ERROR: Room [会議室ID] is already booked for this time`

- 社員が重複している場合  
  `ERROR: Employee [社員ID] already has a booking for this time`

- 予約が存在しない場合（取消・変更時）  
  `ERROR: Booking [予約ID] not found`

- 既に取消済みの場合  
  `ERROR: Booking [予約ID] is already cancelled`

### システムの処理順序

システムは以下の3ステップの処理をこの順序で行う。

1. **Step 1**: 現在時刻の設定・更新
2. **Step 2**: クエリの処理
3. **Step 3**: 結果の出力

### 入出力形式

プログラムに与えられる入力は、標準入力を介して行われる。
改行コードは\n (<LF>)である。最終行の末尾にも改行コードが付与される。
入力は、各種セットアップコマンドと予約関連コマンドが時系列順に与えられる。コマンドの数は与えられないので標準入力の最終行まで読み込むこと。これらの数は合計で200以下であることが保証される。

### コマンド

#### SET_TIME コマンド

現在時刻を設定する。
```
SET_TIME [日付] [時刻]
```

例：現在時刻を2024年12月1日の10:00に設定
```
SET_TIME 2024-12-01 10:00
```

#### SETUP_ROOM コマンド

会議室情報を登録する。
```
SETUP_ROOM [会議室ID] [会議室名] [収容人数] [設備タイプ]
```

例：会議室A01「大会議室」を収容人数20人、プロジェクター付きとして登録
```
SETUP_ROOM A01 大会議室 20 PROJECTOR
```

#### SETUP_EMPLOYEE コマンド

社員情報を登録する。
```
SETUP_EMPLOYEE [社員ID] [社員名] [部署]
```

例：社員100001「田中太郎」を営業部として登録
```
SETUP_EMPLOYEE 100001 田中太郎 営業部
```

#### BOOK コマンド

会議室を予約する。
```
BOOK [社員ID] [会議室ID] [開始日] [開始時刻] [終了日] [終了時刻] [参加予定人数]
```

例：社員100001が会議室A01を2024年12月1日の14:00〜16:00で5人の予約
```
BOOK 100001 A01 2024-12-01 14:00 2024-12-01 16:00 5
```

#### BOOK_RECURRING コマンド

繰り返し予約を作成する。
```
BOOK_RECURRING [社員ID] [会議室ID] [開始時刻] [終了時刻] [参加予定人数] [開始日] [終了日]
```

例：社員100001が会議室A01を毎週月曜日の10:00〜11:00で2024年12月2日から2024年12月30日まで予約
```
BOOK_RECURRING 100001 A01 10:00 11:00 5 2024-12-02 2024-12-30
```

#### CANCEL コマンド

予約を取り消す。
```
CANCEL [予約ID]
```

例：予約ID10001を取り消し
```
CANCEL 10001
```

#### STATUS コマンド

会議室の指定日の予約状況を確認する。
```
STATUS [会議室ID] [日付]
```

例：会議室A01の2024年12月1日の予約状況を確認
```
STATUS A01 2024-12-01
```

#### LIST_EMPLOYEE コマンド

指定社員の予約一覧を表示する。
```
LIST_EMPLOYEE [社員ID] [開始日] [終了日]
```

例：社員100001の2024年12月1日から7日までの予約一覧
```
LIST_EMPLOYEE 100001 2024-12-01 2024-12-07
```

### 出力

#### BOOK コマンド

成功時：
```
BOOKING_SUCCESS: [予約ID] booked for [社員ID] in room [会議室ID] from [開始日時] to [終了日時]
```

エラー時：
```
ERROR: [エラーメッセージ]
```

#### BOOK_RECURRING コマンド

成功時：
```
RECURRING_SUCCESS: [作成された予約数] bookings created from [開始日] to [終了日]
```

エラー時：
```
ERROR: [エラーメッセージ]
```

#### CANCEL コマンド

成功時：
```
CANCEL_SUCCESS: Booking [予約ID] cancelled
```

エラー時：
```
ERROR: [エラーメッセージ]
```

#### STATUS コマンド

```
ROOM_STATUS [会議室ID] [日付]:
[開始時刻]-[終了時刻]: [予約ID] ([社員名], [参加人数]人)
...
(予約がない場合は "No bookings" を表示)
```

#### LIST_EMPLOYEE コマンド

```
EMPLOYEE_BOOKINGS [社員ID]:
[日付] [開始時刻]-[終了時刻]: [会議室ID] ([参加人数]人) [予約ID]
...
(予約がない場合は "No bookings" を表示)
```

セットアップコマンド（SET_TIME、SETUP_ROOM、SETUP_EMPLOYEE）に対しては出力を行わない。

## テストケース

### テストケース1: 基本的な予約フロー

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK 100001 A01 2024-12-01 10:00 2024-12-01 11:00 5
```

**期待出力:**
```
BOOKING_SUCCESS: 10001 booked for 100001 in room A01 from 2024-12-01 10:00 to 2024-12-01 11:00
```

### テストケース2: 営業時間外エラー

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK 100001 A01 2024-12-01 19:00 2024-12-01 20:00 5
```

**期待出力:**
```
ERROR: Booking outside business hours (Mon-Fri 09:00-18:00)
```

### テストケース3: 収容人数超過エラー

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 小会議室 5 NORMAL
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK 100001 A01 2024-12-01 10:00 2024-12-01 11:00 8
```

**期待出力:**
```
ERROR: Participants exceed room capacity (capacity: 5)
```

### テストケース4: 重複予約エラー

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_EMPLOYEE 100001 田中太郎 営業部
SETUP_EMPLOYEE 100002 佐藤花子 開発部
BOOK 100001 A01 2024-12-01 10:00 2024-12-01 11:00 5
BOOK 100002 A01 2024-12-01 10:30 2024-12-01 11:30 3
```

**期待出力:**
```
BOOKING_SUCCESS: 10001 booked for 100001 in room A01 from 2024-12-01 10:00 to 2024-12-01 11:00
ERROR: Room A01 is already booked for this time
```

### テストケース5: 繰り返し予約

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK_RECURRING 100001 A01 10:00 11:00 5 2024-12-02 2024-12-16
```

**期待出力:**
```
RECURRING_SUCCESS: 3 bookings created from 2024-12-02 to 2024-12-16
```

### テストケース6: 予約取消と状況確認

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK 100001 A01 2024-12-01 10:00 2024-12-01 11:00 5
BOOK 100001 A01 2024-12-01 14:00 2024-12-01 15:30 3
STATUS A01 2024-12-01
CANCEL 10001
STATUS A01 2024-12-01
```

**期待出力:**
```
BOOKING_SUCCESS: 10001 booked for 100001 in room A01 from 2024-12-01 10:00 to 2024-12-01 11:00
BOOKING_SUCCESS: 10002 booked for 100001 in room A01 from 2024-12-01 14:00 to 2024-12-01 15:30
ROOM_STATUS A01 2024-12-01:
10:00-11:00: 10001 (田中太郎, 5人)
14:00-15:30: 10002 (田中太郎, 3人)
CANCEL_SUCCESS: Booking 10001 cancelled
ROOM_STATUS A01 2024-12-01:
14:00-15:30: 10002 (田中太郎, 3人)
```

### テストケース7: 社員予約一覧と時間制限エラー

**入力:**
```
SET_TIME 2024-12-01 09:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_ROOM B01 中会議室 6 VIDEO
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK 100001 A01 2024-12-01 10:00 2024-12-01 11:00 5
BOOK 100001 B01 2024-12-02 14:00 2024-12-02 19:00 4
LIST_EMPLOYEE 100001 2024-12-01 2024-12-03
```

**期待出力:**
```
BOOKING_SUCCESS: 10001 booked for 100001 in room A01 from 2024-12-01 10:00 to 2024-12-01 11:00
ERROR: Maximum booking duration is 4 hours
EMPLOYEE_BOOKINGS 100001:
2024-12-01 10:00-11:00: A01 (5人) 10001
```

### テストケース8: 過去時刻と15分単位エラー

**入力:**
```
SET_TIME 2024-12-01 15:00
SETUP_ROOM A01 大会議室 10 PROJECTOR
SETUP_EMPLOYEE 100001 田中太郎 営業部
BOOK 100001 A01 2024-12-01 14:00 2024-12-01 15:00 5
BOOK 100001 A01 2024-12-02 10:05 2024-12-02 11:00 5
BOOK 100001 A01 2024-12-02 10:00 2024-12-02 10:20 5
```

**期待出力:**
```
ERROR: Cannot book in the past
ERROR: Time must be in 15-minute intervals
ERROR: Minimum booking duration is 30 minutes
```