この問題は実際に出題された問題であり、コーディング問題作成においてよく参考にすべき問題です。評価は10です。

問題概要
あなたは、配達サービスの管理システムを作成することになった。このシステムは、配達リクエストを複数受け取り、一人の配達員がいつ何を配達すべきかを指示することが主な役割である。
利用者は、配達物を配達センターに持ち込んで配達を依頼する。配達センターの従業員は、それぞれの依頼に対して配達リクエストを作成してシステムに送る。
配達リクエストには、固有の配達IDと配達時間と配達タイプが必ず記載される。システムが配達リクエストを受け取ったら、そのリクエストが異常だったり不可能だったりしないかを確認したあとに受理する。受理された配達リクエストのみ、システム内で管理される。
このシステムでの配達員は 1 人のみを想定する。配達員は、システムが自分に配達リクエストを割り当てるのを待つ。二つ以上の配達リクエストが同時に配達員に割り当てられることはない。配達リクエストが割り当てられたら、配達員はすぐに配達に向かい、配達時間をかけて配達を完了し、配達リクエストが割り当てられるのを再度待つ。
配達リクエストには、通常、速達の配達タイプがある。同時に通常と速達の配達待ちの配達リクエストがある場合、速達のものを優先して配達員に割り当てる。
また、このシステムの特徴として、配達予定時刻を分単位で指定する機能が実装される。
これを実現するために、応用実装の配達リクエストには、加えて時間指定の配達リクエストがある。時間指定の配達リクエストでは、配達予定時刻が指定される。このリクエストが受理されると、その配達を行うことが予定される時間帯で、配達員が予約される。例えば、30 分の配達時間の配達リクエストが 21:45 に時間指定されている場合、21:15 から 21:45 まで配達員が予約される。時間指定の配達リクエストが複数受理されている場合、このように予約された時間帯も同じ数だけ存在する。予約された時間には他の配達をすることができないので、これらの予約された時間帯は配達員が忙しい時間帯とみなされる。
システムは、配達リクエストを受け取って管理し、適切な時間になったら配達員に対して配達リクエストを割り当てる。
上記の説明では、細かい仕様や具体的な入出力方式はまだ書かれていないことに注意せよ。下記の「詳細な仕様」に基づいて、配達員に適切な配達リクエストを適切な時間に割り当てるプログラムを実装せよ。

詳細な仕様
日時

与えられる日時は、以下の制約とフォーマットを満たす日付と時刻の組である
日付は 1 以上の整数で表される。日付 n+1 は日付 n の翌日である。また、クエリで与えられる日付は 10 以下であることが保証される。
時刻は hh:mm 形式で与えられる。00 < hh < 23, 00 < mm < 59 が保証される。

配達リクエスト

配達リクエストは以下の情報を持つ。
配達ID: 5 桁の数字。先頭の数字が0であるような番号も与えられうる。
状態: 配達待ち、配達中、配達済のどれか。
タイプ: NORMAL (通常), EXPRESS (速達), SCHEDULED (時間指定) のどれか。
配達時間: 配達の所要時間 (分)

SCHEDULED タイプの配達リクエストは、加えて以下の情報を持つ。
配達予定時刻: 配達が完了すべき時刻
配達時間帯: 配達を行っている時間帯。つまり、「配達予定時刻から配達時間だけ前〜配達予定時刻」の時間帯を指す。ただし、配達予定時刻から配達時間だけ前は含み、配達予定時刻は含まない。

配達員

配達員の状態には二通りあり、配達リクエストが割り当てられて配達中か、配達リクエストの割り当て待ちかのどちらかである。
配達員の忙しい時間帯がシステムに管理される。忙しい時間帯に被る配達リクエストの受理はなされず、また、忙しい時間帯に被る配達の割り当ては行われない。
時間指定の配達リクエストが存在しない基本実装では、忙しい時間帯は存在しないので、忙しい時間帯に配達リクエストや配達の割り当てが抵触する場合は考えなくてよい。

システムが時間指定の配達リクエストを受理したら、配達員は必ず配達予定時刻から配達時間分だけ前の時刻に、その配達が割り当てられなければならない。そのため、配達予定時刻から配達時間分だけ前〜配達予定時刻の間、配達員は配達をしなければならないので、他の配達が行われないように調整する必要がある。
時間指定の配達リクエストが存在する応用実装では、忙しい時間帯は以下のように定義される。
忙しい時間帯とは、SCHEDULED タイプの配達リクエストの配達が予定されている時間帯である。より厳密には、受理された SCHEDULED タイプの配達リクエストそれぞれについて配達時間帯を列挙し、それらの和集合が忙しい時間帯である。

配達員への割り当て
配達員が割り当てを待っている状態ならば、毎分ごとに、システムは割り当てるべき配達リクエストがないかを確認する。割り当てるべき配達リクエストは、各時刻で 0 個もしくは 1 個である。
割り当てるべき配達リクエストを探すために、システムは以下の条件を上から下の順に確認する。

現在が、配達待ちの SCHEDULED タイプの配達リクエストを割り当てるべき時刻であれば、それを割り当てる。
厳密には、受理された配達待ちの SCHEDULED タイプの配達リクエストの中で、現在時刻から配達時間後に配達予定時刻と一致するものがあればそれを割り当てる。
「配達待ち」かつ「今割り当ててもその配達時間帯が忙しい時間に被らない」の配達リクエストのうち、タイプが速達のものがあるかを確認する。あるならば、そのうち最も配達リクエストの日時が早いものを割り当てる。
「配達待ち」かつ「今割り当ててもその配達時間帯が忙しい時間に被らない」の配達リクエストのうち、タイプが通常のものがあるかを確認する。あるならば、そのうち最も配達リクエストの日時が早いものを割り当てる。

配達員が配達を割り当てられたら、その時刻から配達時間後までの間、配達中の状態になる。ただし、配達が割り当てられた瞬間は配達中であるが、割り当てられた時刻から配達時間後ちょうどでは割り当て待ちの状態であるものとする。
配達リクエストの受理

NORMAL および EXPRESS タイプの配達リクエストが受理されるためには、配達時間が 120 分以下である必要がある。

SCHEDULED タイプの配達リクエストが受理されるためには、以下の全てを満たす必要がある。
配達時間が 60 分以下
今すぐに配達を始めれば、配達予定時刻かそれより前に配達が完了できる。つまり、配達予定時刻が、現在から配達時間だけ経過した時刻もしくはそれより後である。
現在配達中の配達リクエストがある場合は、その配達を完了してからすぐに配達を始めれば、配達予定時刻かそれより前に配達が完了できる。つまり、配達予定時刻が、現在配達中の配達が終わる時刻から配達時間だけ経過した時刻よりも後である。
現在の忙しい時間が、今受理しようとしている配達リクエストの配達時間に被らない。
SCHEDULED タイプの配達リクエストが受理されたら、忙しい時間にその配達時間帯を追加する。

配達リクエストのキャンセル

受理された配達待ちの配達リクエストは、キャンセルできる。
NORMAL と EXPRESS タイプの配達リクエストは、今後、受理された配達リクエストとみなされなくなる。
SCHEDULED タイプの配達リクエストは、受理された配達リクエストとみなされなくなる。また、そのリクエストの配達時間帯を忙しい時間から削除する。
受理されていない配達リクエストや、配達中・配達済みの配達リクエストは、キャンセルできない。

配達リクエストの状態確認

受理された配達リクエストが、配達待ちなのか配達中なのか配達済みなのかを調べるための機能が実装される必要がある。
受理されていない配達リクエストの状態を確認することはできない。

システムの処理順序

システムは毎分、以下の 3 ステップの処理をこの順序で行う。
Step 1: その時刻で配達完了した配達リクエストがあるかを確認し、あれば配達完了のお知らせを出力する。配達が完了したら、その配達リクエストは配達済み状態になり、配達員は割り当てを待ち始める。
Step 2: その時刻でクエリが与えられたかを確認し、あればクエリの処理を行う。
Step 3: その時刻で配達リクエストが配達員に割り当てられたかを確認し、配達リクエストの割り当てを出力する。配達リクエストが割り当てられたら、その配達リクエストは配達中状態になり、配達員も配達中の状態になる。

入出力形式

プログラムに与えられる入力は、標準入力を介して行われる。
改行コードは\n (<LF>)である。最終行の末尾にも改行コードが付与される。
入力は、NORMAL クエリ・EXPRESS クエリ・SCHEDULED クエリ、CANCEL クエリ、STATUS クエリが時系列順に与えられる。クエリと情報の数は与えられないので標準入力の最終行まで読み込むこと。これらの数は合計で 100 以下であることが保証される。
同じ時刻のクエリは与えられない。
同じ時刻で複数行に渡って出力を行う必要があるときは、「配達完了のお知らせ」「クエリの出力」「配達リクエストの割り当て」の順に出力せよ。

Step 1: 配達完了のお知らせ

それぞれの時刻で、その時刻に配達が完了するような配達リクエストがあるかを確認して、もしあれば以下を 1 行で出力せよ。

[日時] [配達ID] has been delivered.
Step 2: クエリ
NORMAL クエリ

従業員が、NORMAL タイプの配達リクエストをシステムに送るためのクエリである。
日時、文字列NORMAL、配達ID、配達時間がスペース区切りで与えられる。

例: 日付 3 の 5 時 12 分に、配達IDjfisfの配達リクエスト (タイプ NORMAL) が発行された。この配達は 20 分で完了する。
3 05:12 NORMAL jfisf 20

上から条件を確認し、該当する出力を 1 行で出力せよ。
配達時間が 120 分以下ではない場合、以下を 1 行で出力せよ。

[日時] ERROR: Delivery time cannot exceed 120 minutes.

配達リクエストが受理される場合、以下を 1 行で出力せよ。

[日時] [配達ID] has been accepted.
EXPRESS クエリ

従業員が、EXPRESS タイプの配達リクエストをシステムに送るためのクエリである。
日時、文字列EXPRESS、配達ID、配達時間がスペース区切りで与えられる。

例: 日付 3 の 5 時 12 分に、配達IDjfisfの配達リクエスト (タイプ EXPRESS) が発行された。この配達は 20 分で完了する。
3 05:12 EXPRESS jfisf 20

上から条件を確認し、該当する出力を 1 行で出力せよ。
配達時間が 120 分以下ではない場合、以下を 1 行で出力せよ。

[日時] ERROR: Delivery time cannot exceed 120 minutes.

配達リクエストが受理される場合、以下を 1 行で出力せよ。

[日時] [配達ID] has been accepted.
SCHEDULED クエリ（応用実装）

従業員が、SCHEDULED タイプの配達リクエストをシステムに送るためのクエリである。
日時、文字列SCHEDULED、配達ID、配達時間、配達予定時刻がスペース区切りで与えられる。

例: 日付 3 の 05:12 に、配達IDjfisfの配達リクエスト (タイプ SCHEDULED) が発行された。日付 4 の 21:00 に配達されるよう時間指定されており、配達時間は 30 分である。そのため、システムは配達員に対して日付 4 の 20:30 に配達を指示する必要があり、20:30 から 21:00 までが忙しい時間に追加される。
3 05:12 SCHEDULED jfisf 30 4 21:00

上から条件を確認し、該当する出力を 1 行で出力せよ。
配達時間が 60 分以下ではない場合、以下を出力せよ。

[日時] ERROR: Delivery time cannot exceed 60 minutes.

今からすぐに配達を始めても希望の配達予定時刻に配達ができない場合は、以下を出力せよ。具体的には、配達予定時刻が、現在から配達時間だけ経過した時刻よりも前である場合にこのエラーメッセージが出力される。

[日時] ERROR: The scheduled delivery time is too close.

現在配達中の配達リクエストがあり、かつ、その配達を完了してからすぐに配達を始めても配達予定時刻に配達が完了できない場合は、以下を出力せよ。具体的には、配達予定時刻が、現在配達中の配達が終わる時刻から配達時間だけ経過した時刻よりも前である場合にこのエラーメッセージが出力される。

[日時] ERROR: The scheduled delivery time is too close because other delivery is being made.

現在の忙しい時間が、今受理しようとしている SCHEDULED タイプの配達リクエストの配達時間に被っている場合は、以下を出力せよ。

[日時] ERROR: The scheduled delivery time cannot be specified because the delivery person is busy making another delivery.

上記のいずれにも当てはまらない場合、以下を出力せよ。

[日時] [配達ID] has been accepted.
CANCEL クエリ

ユーザが、配達リクエストのキャンセルをシステムに送るためのクエリである。
日時、文字列CANCEL、配達IDがスペース区切りで与えられる。

例: 日付 3 の 05:12 に、配達IDjfisfの配達リクエストをキャンセルしたい場合
3 05:12 CANCEL jfisf

上から条件を確認し、該当する出力を 1 行で出力せよ。
キャンセルしようとしている配達リクエストが過去に受理されたものではない場合は、以下を出力せよ。

[日時] ERROR: The request is not found.

キャンセルしようとしている配達リクエストが、配達中もしくは配達済みの場合は、以下を出力せよ。

[日時] ERROR: The request that has been processed cannot be cancelled.

上記のいずれにも当てはまらない場合、以下を出力せよ。

[日時] [配達ID] has been cancelled.
STATUS クエリ

ユーザが、配達リクエストの状態を確認するためのクエリである。
日時、文字列STATUS、配達IDがスペース区切りで与えられる。

例: 日付 3 の 05:12 に、配達IDjfisfの配達リクエストの状態を確認した場合
3 05:12 STATUS jfisf

上から条件を確認し、該当する出力を 1 行で出力せよ。
確認しようとしている配達リクエストが過去に受理されたものではない場合は、以下を出力せよ。

[日時] ERROR: The request is not found.

確認しようとしている配達リクエストが配達待ちの場合は、以下を出力せよ。

[日時] [配達ID] is awaiting delivery.

確認しようとしている配達リクエストが配達中の場合は、以下を出力せよ。

[日時] [配達ID] is being delivered.

確認しようとしている配達リクエストが配達済の場合は、以下を出力せよ。

[日時] [配達ID] has been delivered.
Step 3: 配達リクエストの割り当て

それぞれの時刻で、その時刻に割り当てられた配達リクエストが存在するかを確認し、もし存在するならば以下を 1 行で出力せよ。

[日時] [配達ID] has been assigned.


テストケース

テストケース1: 基本的な配達フロー

入力:
1 10:00 NORMAL 12345 30
1 10:05 EXPRESS 12346 20

期待出力:
1 10:00 12345 has been accepted.
1 10:00 12345 has been assigned.
1 10:05 12346 has been accepted.
1 10:30 12345 has been delivered.
1 10:30 12346 has been assigned.
1 10:50 12346 has been delivered.

テストケース2: 配達時間超過エラー

入力:
1 10:00 NORMAL 12345 150

期待出力:
1 10:00 ERROR: Delivery time cannot exceed 120 minutes.

テストケース3: EXPRESS優先処理

入力:
1 10:00 NORMAL 12345 30
1 10:05 EXPRESS 12346 20
1 10:10 STATUS 12345
1 10:10 STATUS 12346

期待出力:
1 10:00 12345 has been accepted.
1 10:00 12345 has been assigned.
1 10:05 12346 has been accepted.
1 10:10 12345 is being delivered.
1 10:10 12346 is awaiting delivery.
1 10:30 12345 has been delivered.
1 10:30 12346 has been assigned.
1 10:50 12346 has been delivered.

テストケース4: 時間指定配達

入力:
1 10:00 SCHEDULED 12345 30 1 11:00
1 10:30 NORMAL 12346 20

期待出力:
1 10:00 12345 has been accepted.
1 10:30 12346 has been accepted.
1 10:30 12346 has been assigned.
1 10:50 12346 has been delivered.
1 10:50 12345 has been assigned.
1 11:00 12345 has been delivered.

テストケース5: 時間指定配達エラー（時間が近すぎる）

入力:
1 10:00 SCHEDULED 12345 30 1 10:20

期待出力:
1 10:00 ERROR: The scheduled delivery time is too close.

テストケース6: キャンセル機能

入力:
1 10:00 NORMAL 12345 30
1 10:05 CANCEL 12345
1 10:10 STATUS 12345

期待出力:
1 10:00 12345 has been accepted.
1 10:05 12345 has been cancelled.
1 10:10 ERROR: The request is not found.
