評価6

問題概要
あなたは、レストランチェーンのオンライン注文・決済システムを作成することになった。このシステムは、顧客からの注文を受け付け、在庫を管理し、各種割引やポイントを適用して最終的な請求額を計算することが主な役割である。
顧客は、オンラインで商品を選択して注文を行う。注文時には店舗を指定し、商品と数量を選択する。会員である場合はポイントの使用や獲得が可能であり、クーポンコードを入力することで割引を受けることもできる。
システムは24時間稼働するが、各店舗には営業時間が設定されている。営業時間外の注文は受け付けない。また、在庫が不足している場合も注文を受け付けることができない。
注文処理では、時間帯による自動割引、クーポンによる割引、会員ポイントの使用という順序で割引が適用される。最終的な請求額に対して、会員ランクに応じたポイントが付与される。
このシステムの特徴として、時間帯による自動割引機能が実装される。モーニング、ランチ、ハッピーアワー、深夜といった時間帯に応じて、特定のカテゴリの商品や組み合わせに対して割引が自動的に適用される。
上記の説明では、細かい仕様や具体的な入出力方式はまだ書かれていないことに注意せよ。下記の「詳細な仕様」に基づいて、注文を適切に処理し、正確な請求額を計算するプログラムを実装せよ。

詳細な仕様
時刻
与えられる時刻は、以下の制約とフォーマットを満たす。

時刻は HH:MM 形式で与えられる。00:00 ≤ HH:MM ≤ 23:59 が保証される。
時刻の比較は、00:00を起点とした分数で行う。

店舗
店舗は以下の情報を持つ。

店舗ID: 3桁の数字。001から999までの値を取る。
営業時間: 開店時刻と閉店時刻のペア。
在庫: 商品IDごとの在庫数を管理する。

営業時間の判定において、開店時刻は含み、閉店時刻は含まない。例えば、09:00〜22:00の営業時間の場合、09:00は営業中だが22:00は営業時間外となる。

商品
商品は以下の情報を持つ。

商品ID: 4文字の英数字。大文字のアルファベット1文字と3桁の数字で構成される（例：A001）。
商品名: 文字列。日本語を含むことができる。
基本価格: 正の整数（円）。
カテゴリ: FOOD（食品）、DRINK（飲料）、DESSERT（デザート）のいずれか。

会員
会員は以下の情報を持つ。

会員ID: 6桁の数字。100000から999999までの値を取る。
会員ランク: REGULAR、SILVER、GOLD、PLATINUMの4段階。
保有ポイント: 0以上の整数。

会員ランクによるポイント還元率は以下の通りである。

REGULAR: 最終請求額の1%（小数点以下切り捨て）
SILVER: 最終請求額の2%（小数点以下切り捨て）
GOLD: 最終請求額の3%（小数点以下切り捨て）
PLATINUM: 最終請求額の5%（小数点以下切り捨て）

非会員の注文も可能であり、その場合は会員IDの代わりにGUESTと指定される。非会員はポイントの獲得・使用ができない。
時間帯割引
以下の時間帯に該当する注文には、自動的に割引が適用される。
モーニング割引（06:00〜10:00）

FOODカテゴリの商品が10%割引される。
適用時間: 06:00以上10:00未満

ランチ割引（11:00〜14:00）

FOODカテゴリとDRINKカテゴリの商品を両方含む注文の場合、注文全体が15%割引される。
適用時間: 11:00以上14:00未満
条件: 注文にFOOD商品とDRINK商品が少なくとも1つずつ含まれていること。

ハッピーアワー割引（17:00〜19:00）

DRINKカテゴリの商品が20%割引される。
適用時間: 17:00以上19:00未満

深夜割引（22:00〜05:59）

全商品が5%割引される。
適用時間: 22:00以上24:00未満、または00:00以上06:00未満

複数の時間帯割引の条件を満たす場合は、最も割引額が大きくなる割引のみを適用する。割引の重複適用は行わない。

クーポンコード
クーポンコードは以下の3種類の形式をサポートする。
固定金額割引（FIXED_金額）

形式: FIXED_の後に金額を指定（例：FIXED_500）
効果: 指定された金額を割引する。

パーセント割引（PERCENT_割合）

形式: PERCENT_の後に割合を指定（例：PERCENT_20）
効果: 指定された割合（%）を割引する。

カテゴリ別割引（CATEGORY_カテゴリ_割合）

形式: CATEGORY_カテゴリ名_割合を指定（例：CATEGORY_DRINK_30）
効果: 指定されたカテゴリの商品のみ、指定された割合（%）を割引する。
カテゴリ名はFOOD、DRINK、DESSERTのいずれか。

クーポンコードがNONEと指定された場合は、クーポン割引を適用しない。
無効なクーポンコード形式が指定された場合はエラーとする。


価格計算の手順
注文の価格計算は以下の手順で行う。

基本価格の計算: 各商品の基本価格×数量を合計する。
時間帯割引の適用: 該当する時間帯割引がある場合、割引を適用する。
クーポン割引の適用: クーポンコードが指定されている場合、割引を適用する。
ポイント使用: 会員がポイントを使用する場合、1ポイント=1円として差し引く。
最終請求額の確定: 最終請求額は0円以上とする（マイナスにはならない）。
ポイント付与: 会員の場合、最終請求額に対してランクに応じたポイントを付与する。

割引計算において、小数点以下は各段階で切り捨てる。


注文処理の流れ
システムが注文を受け取ったら、以下の順序で処理を行う。

店舗の存在確認: 指定された店舗IDが登録されているか確認する。
営業時間の確認: 注文時刻が店舗の営業時間内か確認する。
商品の存在確認: 注文された全ての商品IDが登録されているか確認する。
在庫の確認: 注文された全ての商品について、必要な数量の在庫があるか確認する。
会員の確認: 会員IDが指定されている場合、その会員が登録されているか確認する。
ポイント残高の確認: ポイントを使用する場合、保有ポイントが十分か確認する。
価格計算: 上記の価格計算手順に従って最終請求額を計算する。
在庫の更新: 注文が確定したら、在庫から注文数量を減らす。
ポイントの更新: 会員の場合、使用ポイントを減らし、獲得ポイントを加える。


エラー処理
以下の場合はエラーメッセージを出力し、注文を処理しない。
店舗が存在しない場合
ERROR: Store [店舗ID] not found
営業時間外の場合
ERROR: Store [店舗ID] is closed
商品が存在しない場合
ERROR: Product [商品ID] not found
在庫不足の場合
ERROR: Insufficient stock for product [商品ID] (requested: [要求数], available: [在庫数])
会員が存在しない場合
ERROR: Member [会員ID] not found
ポイント不足の場合
ERROR: Insufficient points (requested: [要求ポイント], available: [保有ポイント])
無効なクーポンコードの場合
ERROR: Invalid coupon code [クーポンコード]


入出力形式
プログラムに与えられる入力は、標準入力を介して行われる。
改行コードは\n (<LF>)である。最終行の末尾にも改行コードが付与される。
入力は、各種セットアップコマンドと注文コマンドが時系列順に与えられる。コマンドの数は与えられないので標準入力の最終行まで読み込むこと。

コマンド
SETUP_STORE コマンド
店舗情報を登録する。
SETUP_STORE [店舗ID] [開店時刻] [閉店時刻]
例：店舗001を09:00から22:00まで営業として登録
SETUP_STORE 001 09:00 22:00

SETUP_PRODUCT コマンド
商品情報を登録する。
SETUP_PRODUCT [商品ID] [商品名] [価格] [カテゴリ]
例：商品A001「ハンバーガー」を500円、FOODカテゴリとして登録
SETUP_PRODUCT A001 ハンバーガー 500 FOOD

SETUP_MEMBER コマンド
会員情報を登録する。
SETUP_MEMBER [会員ID] [ランク] [保有ポイント]
例：会員100001をGOLDランク、1000ポイント保有として登録
SETUP_MEMBER 100001 GOLD 1000

ADD_STOCK コマンド
店舗の在庫を追加する。
ADD_STOCK [店舗ID] [商品ID] [追加数量]
例：店舗001の商品A001の在庫を10個追加
ADD_STOCK 001 A001 10

ORDER コマンド
注文を処理する。
ORDER [注文時刻] [店舗ID] [会員ID/GUEST] [商品ID:数量,商品ID:数量,...] [クーポンコード/NONE] [使用ポイント]
例：12:30に店舗001で会員100001が商品A001を1個、D001を1個注文、クーポンなし、ポイント使用なし
ORDER 12:30 001 100001 A001:1,D001:1 NONE 0


出力
ORDERコマンドに対してのみ、以下の形式で出力する。
注文成功時
[時刻] ORDER_SUCCESS: Total=[最終請求額], Points_Earned=[獲得ポイント], Points_Used=[使用ポイント]

エラー時
[時刻] ERROR: [エラーメッセージ]
セットアップコマンド（SETUP_STORE、SETUP_PRODUCT、SETUP_MEMBER、ADD_STOCK）に対しては出力を行わない。


テストケース
テストケース1: 基本的な注文処理とランチ割引

入力:
SETUP_STORE 001 09:00 22:00
SETUP_PRODUCT A001 ハンバーガー 500 FOOD
SETUP_PRODUCT D001 コーラ 200 DRINK
SETUP_MEMBER 100001 GOLD 1000
ADD_STOCK 001 A001 10
ADD_STOCK 001 D001 20
ORDER 12:30 001 100001 A001:1,D001:1 NONE 0

期待出力:
12:30 ORDER_SUCCESS: Total=595, Points_Earned=17, Points_Used=0

テストケース2: 営業時間外エラー

入力:
SETUP_STORE 001 09:00 22:00
SETUP_PRODUCT A001 ハンバーガー 500 FOOD
ADD_STOCK 001 A001 10
ORDER 23:00 001 GUEST A001:1 NONE 0

期待出力:
23:00 ERROR: Store 001 is closed

テストケース3: 在庫不足エラー

入力:
SETUP_STORE 001 09:00 22:00
SETUP_PRODUCT A001 ハンバーガー 500 FOOD
ADD_STOCK 001 A001 2
ORDER 12:00 001 GUEST A001:3 NONE 0

期待出力:
12:00 ERROR: Insufficient stock for product A001 (requested: 3, available: 2)

テストケース4: モーニング割引とクーポン併用

入力:
SETUP_STORE 001 06:00 22:00
SETUP_PRODUCT A001 モーニングセット 800 FOOD
SETUP_MEMBER 100002 SILVER 500
ADD_STOCK 001 A001 5
ORDER 08:30 001 100002 A001:2 FIXED_200 0

期待出力:
08:30 ORDER_SUCCESS: Total=1240, Points_Earned=24, Points_Used=0

テストケース5: ポイント使用とハッピーアワー割引

入力:
SETUP_STORE 001 09:00 22:00
SETUP_PRODUCT D001 コーヒー 300 DRINK
SETUP_MEMBER 100003 PLATINUM 500
ADD_STOCK 001 D001 10
ORDER 18:00 001 100003 D001:1 NONE 300

期待出力:
18:00 ORDER_SUCCESS: Total=0, Points_Earned=0, Points_Used=240

テストケース6: 深夜割引と複数商品

入力:
SETUP_STORE 002 00:00 23:59
SETUP_PRODUCT A001 チキン 600 FOOD
SETUP_PRODUCT D001 ビール 400 DRINK
SETUP_PRODUCT S001 アイス 350 DESSERT
SETUP_MEMBER 100004 REGULAR 0
ADD_STOCK 002 A001 10
ADD_STOCK 002 D001 10
ADD_STOCK 002 S001 10
ORDER 23:30 002 100004 A001:1,D001:2,S001:1 PERCENT_10 0

期待出力:
23:30 ORDER_SUCCESS: Total=1539, Points_Earned=15, Points_Used=0

テストケース7: カテゴリ別クーポン
入力:
SETUP_STORE 001 09:00 22:00
SETUP_PRODUCT D001 オレンジジュース 250 DRINK
SETUP_PRODUCT D002 アイスコーヒー 350 DRINK
ADD_STOCK 001 D001 10
ADD_STOCK 001 D002 10
ORDER 15:00 001 GUEST D001:2,D002:1 CATEGORY_DRINK_30 0

期待出力:
15:00 ORDER_SUCCESS: Total=595, Points_Earned=0, Points_Used=0